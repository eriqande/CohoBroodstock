---
title: 'CohoBroodstock'
date: '`r format(Sys.time(), "%d %B, %Y")`'
output:
  github_document:
    toc: yes
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "readme-figs/"
)
```

The goal of CohoBroodstock is to put a bunch of useful functions into one place to expedite
Libby's coho broodstock management work.

## Installing

If you don't already have the `devtools` package, then do:
```{r, eval=FALSE}
install.packages("devtools")
```

Then use it to install this from GitHub:
```{r, eval=FALSE}
devtools::install_github("eriqande/CohoBroodstock")
```

You also have to get the `related` package installed from R-forge.  That 
requires some gfortran compilation.  We did that for Libby already.

## Actual vs Optimal vs Random Relatedness

Here is how it goes. First, read the symmetrical full matrix of rxy values:
```{r, message=FALSE, warning=FALSE}
library(CohoBroodstock)
library(tidyverse)

file_path <- system.file("extdata/IGH_W1718_master_Kinsh_res.txt.gz", package = "CohoBroodstock")

rxys <- read_kinship_matrix(file_path)
```

Here is what the first few rows of that look like
```{r}
rxys[1:10, ]
```


Then we need to read in the actual spawn pairs.  This should be two columns: first Female and then Male:
```{r, message=FALSE}
pairs_file <- system.file("extdata/IGH_W1718_actual_spawn_pairs.csv", package = "CohoBroodstock")
actual_pairs <- read_csv(pairs_file)
```

This looks like this:
```{r}
actual_pairs[1:10, ]
```

Then we get the Rxy's of the actual spawn pairs, and alsothe same number of Optimal-mate Rxys, and the
same number of Random-mate Rxys:
```{r}
set.seed(10)  # set a random number seed for reproducibility
AOR <- aor_pairs(actual_pairs, rxys)

# have a look at it:
AOR
```

Then plot those values in a histogram:
```{r aor_histo1}
cols <- c(Actual = "gold", Optimal = "limegreen", Random = "steelblue1")
ggplot(AOR, aes(x =  rxy, fill = `Spawn Pairs`)) +
  geom_histogram(position = "dodge", alpha = 0.75, binwidth = 0.03, color = "black", size = 0.2) +
  scale_fill_manual(values = cols)
```
